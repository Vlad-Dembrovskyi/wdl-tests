#!/bin/bash
# make sure there is no preexisting Docker CID file
rm -f /home/tiago/GitRepos/wdl-tests/cromwell-executions/test/90a6e8c4-d279-4025-8bec-6cd46ab7227c/call-bye/execution/docker_cid
# run as in the original configuration without --rm flag (will remove later)
docker run \
  --cidfile /home/tiago/GitRepos/wdl-tests/cromwell-executions/test/90a6e8c4-d279-4025-8bec-6cd46ab7227c/call-bye/execution/docker_cid \
  -i \
   \
  --entrypoint /bin/bash \
  -v /home/tiago/GitRepos/wdl-tests/cromwell-executions/test/90a6e8c4-d279-4025-8bec-6cd46ab7227c/call-bye:/cromwell-executions/test/90a6e8c4-d279-4025-8bec-6cd46ab7227c/call-bye:delegated \
  ubuntu@sha256:3093096ee188f8ff4531949b8f6115af4747ec1c58858c091c8cb4579c39cc4e /cromwell-executions/test/90a6e8c4-d279-4025-8bec-6cd46ab7227c/call-bye/execution/script

# get the return code (working even if the container was detached)
rc=$(docker wait `cat /home/tiago/GitRepos/wdl-tests/cromwell-executions/test/90a6e8c4-d279-4025-8bec-6cd46ab7227c/call-bye/execution/docker_cid`)

# remove the container after waiting
docker rm `cat /home/tiago/GitRepos/wdl-tests/cromwell-executions/test/90a6e8c4-d279-4025-8bec-6cd46ab7227c/call-bye/execution/docker_cid`

# return exit code
exit $rc
